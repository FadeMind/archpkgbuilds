# Maintainer: FadeMind <fademind@gmail.com>
# Contributor: Yarema aka Knedlyk <yupadmin@gmail.com>

pkgname=radiotray
pkgver=0.7.3
pkgrel=7
commit=1717a0e8c143
pkgdesc="An online radio streaming player that runs on a Linux system tray."
arch=('i686' 'x86_64')
url="https://bitbucket.org/carlmig/radio-tray"
license=('GPL')
depends=(gstreamer0.10-{bad,base,good,ugly}-plugins gstreamer0.10-{ffmpeg,python} python2-{dbus,gobject,lxml,notify,xdg} pygtk)
makedepends=('python2')
conflicts=('radiotray-hg' 'radiotray-python3-git')
source=("${pkgname}-${pkgver}.tar.gz::${url}/get/${pkgname}-${pkgver}.tar.gz" 'encoding.patch' 'gtk.patch' 'bookmarks.xml' 'radiotray.desktop')
install="${pkgname}.install"
sha256sums=('464c555b8d9278e918d3718f81a1c0cfa7d9a54018d1a2f6b04b33dc40ea825c'
            'a73badc0ddbf726d3f554e328b8836883bf816751cd0dc2034795a03466cd2df'
            'f208cbf36bd261434230c3e3e6897d90c527665678a913d93856731d23355c6b'
            '1cd0e16a5500c228756ffe5f4817f671ac46534ae955801a44efd1d12aec9250'
            '4c306c0cdac1c82f1e2fa101433b0d29fd33f8642b177b9ac55095ab8729c815')
     
package() {
    cd ${srcdir}/carlmig-radio-tray-${commit}
    patch -p1 < ${srcdir}/encoding.patch || return 1
    patch -p1 < ${srcdir}/gtk.patch || return 1
    install -dm755 ${pkgdir}/usr
    python2 setup.py install --root=${pkgdir}/ --optimize=1 || return 1
    chmod +x ${pkgdir}/usr/bin/${pkgname} || return 1
    mv -f "${pkgdir}/usr/share/${pkgname}/bookmarks.xml" "${pkgdir}/usr/share/${pkgname}/bookmarks-default.xml"
    install -Dm644 "${srcdir}/bookmarks.xml" "${pkgdir}/usr/share/${pkgname}/bookmarks.xml"
    install -Dm644 "${srcdir}/${pkgname}.desktop" "${pkgdir}/usr/share/applications/${pkgname}.desktop"
    install -dm755 ${pkgdir}/usr/share/icons
    cd ${srcdir}/carlmig-radio-tray-${commit}/data/images/
    cp * ${pkgdir}/usr/share/icons
}
